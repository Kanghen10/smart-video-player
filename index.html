<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Smart Video Player</title>
  <style>
    html, body { margin:0; padding:0; background:black; height:100%; width:100%; overflow:hidden; }
    video { width:100%; height:100%; object-fit:contain; background-color:black; }
  </style>
</head>
<body>
  <video id="video" controls muted autoplay playsinline></video>

  <!-- Library scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.3.2/flv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    const video = document.getElementById('video');
    const url = decodeURIComponent(location.hash.slice(1)).trim();

    function requestFullscreen(el) {
      const fn = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
      if (fn) fn.call(el);
    }

    function getExt(u) {
      return u.split('?')[0].split('.').pop().toLowerCase();
    }

    async function setup() {
      if (!url) return alert('Letakkan URL video di hash, misalnya index.html#https://ex.com/video.mp4');
      const ext = getExt(url);

      try {
        if (ext === 'm3u8') {
          // HLS
          if (Hls && Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
              video.play(); requestFullscreen(video);
            });
          } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.onloadedmetadata = () => { video.play(); requestFullscreen(video); };
          } else throw Error('Browser tidak mendukung HLS.');
        }
        else if (ext === 'flv') {
          // FLV
          if (flvjs && flvjs.isSupported()) {
            const flvPlayer = flvjs.createPlayer({ type:'flv', url });
            flvPlayer.attachMediaElement(video);
            flvPlayer.load();
            await video.play();
            requestFullscreen(video);
          } else throw Error('FLV tidak didukung oleh browser.');
        }
        else {
          // Native
          video.src = url;
          video.onloadedmetadata = () => { video.play().then(() => requestFullscreen(video)); };
        }
      }
      catch (err) {
        console.error(err);
        alert('Gagal memutar format "' + ext + '": ' + err.message);
      }
    }

    setup();
  </script>
</body>
</html>
